{% extends 'base.html' %}
{% block title %}Propriet√°rios ‚Äî Propriedades Rurais{% endblock %}

{% block content %}

<style>

/* ---------------------------------------------------------------------------- */
/* ESTILO AGRO PREMIUM ‚Äì mesmo padr√£o do Dashboard                             */
/* ---------------------------------------------------------------------------- */

:root {
    --primary: #2e7d32;
    --primary-green: #388e3c;
    --secondary: #4caf50;
    --background: #f0f2f5;
    --card-bg: #ffffff;
    --border-color: #e0e0e0;
    --header-bg: #e8f5e9;
    --hover-bg: #f5f5f5;
    --light-gray: #f9f9f9;
    --text-color: #000000;
    --shadow-light: rgba(0, 0, 0, 0.08);
}

.professional-card {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 25px;
    width: 100%;
    margin-top: 40px;
    box-shadow: 0 4px 15px var(--shadow-light);
    animation: fadeIn 0.4s ease-in-out;
}

/* t√≠tulo igual ao dashboard */
.card-title {
    font-size: 1.9rem;
    font-weight: 800;
    color: var(--primary-green);
    display: flex;
    align-items: center;
    justify-content: center;
    border-bottom: 2px solid var(--primary-green);
    padding-bottom: 10px;
    margin-bottom: 20px;
    text-align: center;
}

/* filtros das colunas */
.filter-header {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.filter-input {
    padding: 8px 10px;
    font-size: 0.9rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    width: 100%;
    box-sizing: border-box;
    font-family: 'Montserrat', sans-serif;
    background-color: white;
    transition: all 0.3s ease;
}

.filter-input:focus {
    outline: none;
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
}

.filter-input::placeholder {
    color: #888;
    font-size: 0.85rem;
}

/* tabela premium */
.professional-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.98rem;
    font-family: 'Montserrat', sans-serif !important;
    color: var(--text-color);
}

.professional-table thead th {
    background-color: var(--header-bg);
    padding: 14px 12px;
    font-weight: 700;
    color: var(--primary-green);
    border-bottom: 2px solid var(--primary-green);
    text-transform: uppercase;
    letter-spacing: 0.6px;
    vertical-align: top;
}

.professional-table tbody tr {
    border-bottom: 1px solid var(--border-color);
    transition: 0.2s ease;
}

.professional-table tbody tr:nth-child(even) {
    background-color: var(--light-gray);
}

.professional-table tbody tr:hover {
    background-color: var(--hover-bg);
    transform: translateY(-1px);
    box-shadow: 0 2px 5px var(--shadow-light);
}

.professional-table tbody td {
    padding: 13px 12px;
    text-align: center;
    vertical-align: middle;
}

/* mensagem de tabela vazia */
.tabela-vazia {
    text-align: center;
    padding: 30px !important;
    font-style: italic;
    color: #666;
    background-color: var(--light-gray);
}

/* contador de resultados */
.result-count {
    display: block;
    text-align: right;
    margin-bottom: 15px;
    font-size: 0.9rem;
    color: #666;
    font-weight: 600;
}

.result-count span {
    color: var(--primary-green);
    font-weight: 700;
}

/* anima√ß√£o */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* estilo para bot√µes de limpar filtro */
.clear-filter {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #999;
    cursor: pointer;
    font-size: 1.2rem;
    padding: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.clear-filter:hover {
    color: #666;
}

.filter-container {
    position: relative;
}

</style>

<section class="professional-card">

    <h2 class="card-title">
        <span class="me-2">üë§</span> Propriet√°rios Cadastrados
    </h2>

    <span id="resultCount" class="result-count">
        Mostrando <span id="visibleCount">{{ donos|length }}</span> de {{ donos|length }} propriet√°rios
    </span>

    <div class="table-responsive">
        <table class="professional-table" id="ownersTable">
            <thead>
                <tr>
                    <th>
                        <div class="filter-header">
                            <span>üÜî ID</span>
                            <div class="filter-container">
                                <input type="text" class="filter-input" data-column="0" placeholder="Filtrar ID..." title="Filtrar por ID">
                                <button class="clear-filter" onclick="clearFilter(0)">√ó</button>
                            </div>
                        </div>
                    </th>
                    <th>
                        <div class="filter-header">
                            <span>üë®‚Äçüåæ Nome</span>
                            <div class="filter-container">
                                <input type="text" class="filter-input" data-column="1" placeholder="Filtrar nome..." title="Filtrar por nome">
                                <button class="clear-filter" onclick="clearFilter(1)">√ó</button>
                            </div>
                        </div>
                    </th>
                    <th>
                        <div class="filter-header">
                            <span>üìÑ CPF/CNPJ</span>
                            <div class="filter-container">
                                <input type="text" class="filter-input" data-column="2" placeholder="Filtrar CPF/CNPJ..." title="Filtrar por CPF/CNPJ">
                                <button class="clear-filter" onclick="clearFilter(2)">√ó</button>
                            </div>
                        </div>
                    </th>
                    <th>
                        <div class="filter-header">
                            <span>üìû Telefone</span>
                            <div class="filter-container">
                                <input type="text" class="filter-input" data-column="3" placeholder="Filtrar telefone..." title="Filtrar por telefone">
                                <button class="clear-filter" onclick="clearFilter(3)">√ó</button>
                            </div>
                        </div>
                    </th>
                    <th>
                        <div class="filter-header">
                            <span>üìß Email</span>
                            <div class="filter-container">
                                <input type="text" class="filter-input" data-column="4" placeholder="Filtrar email..." title="Filtrar por email">
                                <button class="clear-filter" onclick="clearFilter(4)">√ó</button>
                            </div>
                        </div>
                    </th>
                </tr>
            </thead>

            <tbody id="tableBody">
                {% for d in donos|sort(attribute='id') %}
                <tr class="data-row">
                    <td>{{ d.id }}</td>
                    <td>{{ d.nome }}</td>
                    <td>{{ d.cpf_cnpj }}</td>
                    <td>{{ d.telefone if d.telefone else '-' }}</td>
                    <td>{{ d.email if d.email else '-' }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="tabela-vazia">
                        Nenhum propriet√°rio cadastrado.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const table = document.getElementById('ownersTable');
    const filters = document.querySelectorAll('.filter-input');
    const tableBody = document.getElementById('tableBody');
    const visibleCount = document.getElementById('visibleCount');
    const totalCount = {{ donos|length }};
    let allRows = Array.from(document.querySelectorAll('.data-row'));
    
    // Fun√ß√£o para filtrar a tabela
    function filterTable() {
        let visible = 0;
        
        allRows.forEach(row => {
            const cells = row.querySelectorAll('td');
            let showRow = true;
            
            filters.forEach(filter => {
                const columnIndex = parseInt(filter.getAttribute('data-column'));
                const filterValue = filter.value.toLowerCase().trim();
                
                if (filterValue !== '') {
                    const cellValue = cells[columnIndex]?.textContent.toLowerCase().trim() || '';
                    if (!cellValue.includes(filterValue)) {
                        showRow = false;
                    }
                }
            });
            
            if (showRow) {
                row.style.display = '';
                visible++;
            } else {
                row.style.display = 'none';
            }
        });
        
        // Atualiza contador
        visibleCount.textContent = visible;
        
        // Se todos os filtros estiverem vazios, mostra todas as linhas
        const anyFilterActive = Array.from(filters).some(f => f.value.trim() !== '');
        if (!anyFilterActive) {
            visibleCount.textContent = totalCount;
        }
    }
    
    // Adiciona evento de input para cada filtro
    filters.forEach(filter => {
        filter.addEventListener('input', filterTable);
        
        // Adiciona evento de tecla para limpar com Esc
        filter.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                this.value = '';
                filterTable();
                this.focus();
            }
        });
    });
    
    // Inicializa a tabela ordenada por ID (j√° feito pelo Jinja)
    console.log('Tabela de propriet√°rios carregada com filtros ativos');
});

// Fun√ß√£o para limpar filtro de uma coluna espec√≠fica
function clearFilter(columnIndex) {
    const filter = document.querySelector(`.filter-input[data-column="${columnIndex}"]`);
    if (filter) {
        filter.value = '';
        filter.dispatchEvent(new Event('input'));
        filter.focus();
    }
}

// Adiciona funcionalidade para limpar todos os filtros
document.addEventListener('keydown', function(e) {
    // Ctrl + Alt + F para limpar todos os filtros
    if (e.ctrlKey && e.altKey && e.key === 'f') {
        e.preventDefault();
        document.querySelectorAll('.filter-input').forEach(filter => {
            filter.value = '';
        });
        document.querySelectorAll('.filter-input')[0].dispatchEvent(new Event('input'));
    }
});
</script>
{% endblock %}